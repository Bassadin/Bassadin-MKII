name: Deploy to FTP Server

on:
    push:
        branches: [master]

    workflow_dispatch:

jobs:
    cypress-test:
        name: Cypress tests
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Cypress run
              uses: cypress-io/github-action@v2
              with:
                  command: yarn cypress run-ct
                  build: yarn run build
                  start: yarn run start
    build:
        name: Yarn build
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@master
              with:
                  node-version: 16
            - name: Yarn module install
              run: yarn install --frozen-lockfile
            - name: Yarn build
              run: yarn run build
            - uses: actions/upload-artifact@master
              with:
                  name: build-artifact
                  path: dist/
    deploy:
        needs: [cypress-test]
        runs-on: ubuntu-latest
        name: Deploy to FTP Server
        steps:
            - uses: actions/download-artifact@master
              with:
                  name: build-artifact
                  path: dist/
            - name: Deploy to FTP Server
              uses: SamKirkland/FTP-Deploy-Action@4.0.0
              with:
                  server: ha01s018.org-dns.com
                  username: mkii_github
                  password: ${{ secrets.FTP_Password }}
                  protocol: ftps
                  local-dir: dist/
                  security: strict
#     check-lighthouse:
#         name: Perform Google Lighthouse Check
#         runs-on: ubuntu-latest
#         needs: deploy
#         steps:
#             - uses: foo-software/lighthouse-check-action@master
#               with:
#                   urls: "https://bassadin-mkii.bassadin.de/"
