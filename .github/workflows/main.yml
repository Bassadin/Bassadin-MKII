name: Deploy to FTP Server

on:
    push:
        branches: [master]

    workflow_dispatch:

jobs:
    build:
        name: NPM build
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Cypress run
              uses: cypress-io/github-action@v2
              with:
                command: yarn cypress run-ct
                build: npm run build
                start: npm start
    build:
        name: NPM build
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@master
              with:
                  node-version: 12
            - name: NPM module install
              run: npm install
            - name: NPM build
              run: npm run build
            - uses: actions/upload-artifact@master
              with:
                  name: build-artifact
                  path: dist/
    deploy:
        needs: [build]
        runs-on: ubuntu-latest
        name: Deploy to FTP Server
        steps:
            - uses: actions/download-artifact@master
              with:
                  name: build-artifact
                  path: dist/
            - name: Deploy to FTP Server
              uses: SamKirkland/FTP-Deploy-Action@4.0.0
              with:
                  server: ha01s018.org-dns.com
                  username: mkii_github
                  password: ${{ secrets.FTP_Password }}
                  protocol: ftps
                  local-dir: dist/
                  security: strict
#     check-lighthouse:
#         name: Perform Google Lighthouse Check
#         runs-on: ubuntu-latest
#         needs: deploy
#         steps:
#             - uses: foo-software/lighthouse-check-action@master
#               with:
#                   urls: "https://bassadin-mkii.bassadin.de/"
